<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Foresight CAIXA — Tendências × Pilares</title>
  <meta name="description" content="Mapa Foresight CAIXA — painel interativo de tendências por pilares e maturidade (Wardley Mapping)." />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Mapa Foresight CAIXA — Tendências × Pilares</h1>
    <!-- LEGENDA: somente no topo, linha única -->
    <div class="legenda">
      <span class="pilar" style="--cor:#A05EB5">Cliente no centro</span>
      <span class="pilar" style="--cor:#005CA9">Eficiência e rentabilidade</span>
      <span class="pilar" style="--cor:#CEDC00">Tecnologia e inovação</span>
      <span class="pilar" style="--cor:#FFB549">Pessoas, cultura e agilidade</span>
      <span class="pilar" style="--cor:#00B3B8">Sustentabilidade e cidadania</span>
      <span class="pilar" style="--cor:#FF6F40">Atuação em ecossistema</span>
    </div>
  </header>

  <main>
    <section class="mapa" aria-label="Mapa de tendências">
      <div class="eixo-vertical">Visibilidade para o Cliente</div>
      <div id="grid" class="grid">
        <div class="tick v-top">Altamente visível</div>
        <div class="tick v-bottom">Interface interna</div>
        <div class="tick h-genesis">Genesis</div>
        <div class="tick h-custom">Custom</div>
        <div class="tick h-product">Product</div>
        <div class="tick h-commodity">Commodity</div>
        <div id="tendencias" class="tendencias" role="list"></div>
      </div>
    </section>

    <aside class="painel" aria-live="polite">
      <h2 id="tituloTendencia">Selecione uma tendência</h2>
      <p><strong>Impacto no Cliente:</strong> <span id="impacto">—</span></p>
      <p><strong>Riscos:</strong> <span id="riscos">—</span></p>
      <p><strong>Oportunidades:</strong> <span id="oportunidades">—</span></p>
      <p><strong>Status:</strong> <span id="status">—</span></p>
      <p><strong>Alavancas de Inovação:</strong> <span id="alavancas">—</span></p>
      <p><strong>Iniciativas Relacionadas:</strong> <span id="iniciativas">—</span></p>
      <div class="export">
        <button id="savePositions">Copiar posições (JSON)</button>
        <textarea id="output" placeholder="As posições aparecerão aqui..." readonly></textarea>
      </div>
    </aside>
  </main>

  <script src="data.js"></script>
  <script>
    const grid = document.getElementById('grid');
    const cont = document.getElementById('tendencias');

    // Carrega posições salvas (opcional)
    const saved = localStorage.getItem('tendencias_positions');
    if (saved) {
      try {
        const savedArr = JSON.parse(saved);
        window.tendencias = window.tendencias.map(t => {
          const s = savedArr.find(x => x.nome === t.nome);
          return s ? {...t, x: s.x, y: s.y} : t;
        });
      } catch(e){}
    }

    // Renderização das pílulas
    function render() {
      cont.innerHTML = '';
      (window.tendencias || []).forEach((t) => {
        const el = document.createElement('button');
        el.className = 'pill';
        el.type = 'button';
        el.textContent = t.nome;
        el.style.setProperty('--cor', t.cor);
        el.style.left = (t.x ?? 20) + '%';
        el.style.top = (t.y ?? 50) + '%';
        // Clique para detalhes
        el.addEventListener('click', (ev) => {
          ev.stopPropagation();
          mostrar(t);
        });
        // Drag manual (mouse)
        enableDrag(el, t);
        cont.appendChild(el);
      });
      if (window.tendencias.length) mostrar(window.tendencias[0]);
    }

    function mostrar(t) {
      document.getElementById('tituloTendencia').textContent = t.nome;
      document.getElementById('impacto').textContent = t.impacto || '—';
      document.getElementById('riscos').textContent = t.riscos || '—';
      document.getElementById('oportunidades').textContent = t.oportunidades || '—';
      document.getElementById('status').textContent = t.status || '—';
      document.getElementById('alavancas').textContent = t.alavancas || '—';
      document.getElementById('iniciativas').textContent = t.iniciativas || '—';
    }

    function enableDrag(el, trend) {
      let dragging = false;

      el.addEventListener('mousedown', (e) => {
        dragging = true;
        e.preventDefault();
      });

      window.addEventListener('mouseup', () => dragging = false);

      window.addEventListener('mousemove', (e) => {
        if (!dragging) return;
        const rect = grid.getBoundingClientRect();
        // posição relativa dentro do grid
        let px = ((e.clientX - rect.left) / rect.width) * 100;
        let py = ((e.clientY - rect.top) / rect.height) * 100;
        // limitar a 2%..98% para manter pílula dentro
        px = Math.max(2, Math.min(98, px));
        py = Math.max(2, Math.min(98, py));
        el.style.left = px + '%';
        el.style.top = py + '%';
        // atualiza dados
        trend.x = px;
        trend.y = py;
      });
    }

    // Exportar posições
    document.getElementById('savePositions').addEventListener('click', () => {
      const out = window.tendencias.map(t => ({ nome: t.nome, x: Math.round(t.x), y: Math.round(t.y) }));
      const json = JSON.stringify(out, null, 2);
      document.getElementById('output').value = json;
      localStorage.setItem('tendencias_positions', json);
    });

    render();
  </script>
</body>
</html>
